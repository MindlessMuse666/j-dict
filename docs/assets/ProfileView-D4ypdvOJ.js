import{C as pe,p as L,f as r,o as me,a as xe,c as i,d as t,e as m,k as fe,j as x,l as U,t as h,n as z,H as W,m as ge,v as he,F as be,r as ye,i as we,T as ke,E as Ce,b as u}from"./main-BxZdGOzk.js";import{u as Me}from"./words-DsE0r_wO.js";const X={USER:"user",ADMIN:"admin"},_e={[X.USER]:"Пользователь",[X.ADMIN]:"Администратор"},je={class:"min-h-screen bg-background text-text-primary p-6"},Le={class:"max-w-4xl mx-auto"},Ue={class:"bg-surface rounded-2xl shadow-lg p-8 relative"},ze={class:"flex flex-col md:flex-row gap-8 items-start"},Se={class:"relative group flex-shrink-0 mx-auto md:mx-0 self-center"},$e={class:"w-40 h-40 rounded-full overflow-hidden border-4 border-primary/20 shadow-md bg-background relative z-0"},Be=["src"],He={key:1,class:"absolute top-full left-1/2 -translate-x-1/2 mt-2 w-48 bg-surface rounded-xl shadow-xl border border-border z-30 overflow-hidden"},Re={class:"flex-1 w-full pr-12"},Ie={class:"space-y-1"},Ae={class:"text-3xl font-bold text-text-primary tracking-tight"},De={class:"flex items-center text-text-secondary"},Te={class:"flex items-center text-text-secondary mt-1"},Ye={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},Ee={class:"bg-background px-4 py-3 rounded-xl border border-border"},We={class:"flex items-center gap-2"},Xe={class:"text-xl font-bold text-primary ml-1"},Oe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},Ve={class:"bg-surface rounded-2xl shadow-xl max-w-2xl w-full p-6 relative"},Pe={key:2,class:"flex flex-col items-center"},Ne=["src"],Fe={class:"absolute inset-0 pointer-events-none z-10"},Ge={class:"w-full mt-6 px-2 flex items-center gap-4"},Je=["min","max"],Ze={key:3,class:"flex justify-end gap-3 mt-6"},qe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},Ke={class:"bg-surface rounded-2xl shadow-xl max-w-2xl w-full p-6"},Qe={class:"grid grid-cols-2 sm:grid-cols-4 gap-4"},et=["onClick"],tt=["src"],st={class:"flex justify-end gap-3 mt-4"},ot={key:2,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},at={class:"bg-surface rounded-2xl shadow-xl max-w-md w-full p-6"},rt={class:"flex justify-end gap-3 mt-6"},lt={key:0,class:"fixed bottom-4 right-4 z-50 bg-surface border border-border rounded-xl shadow-lg p-4 flex items-center gap-3"},nt={class:"text-sm font-medium text-text-primary"},C=280,vt={__name:"ProfileView",setup(it){const f=pe(),A=Me(),O=Ce(),g=L(()=>f.user),V=L(()=>A.totalCount),P=L(()=>{var s,e;return _e[(s=g.value)==null?void 0:s.role]||((e=g.value)==null?void 0:e.role)||"Пользователь"}),N=()=>{_.value=!0},F=async()=>{_.value=!1,await f.logout(),O.push({name:"Login"}),p("Вы успешно вышли из системы")},G=L(()=>{var s;return(s=g.value)!=null&&s.avatar_url?g.value.avatar_url:"/jp-ru-dict/assets/default_avatars/~catishe~cat~.jpg"}),J=s=>{console.error("Avatar load error:",s.target.src),s.target.src="/jp-ru-dict/assets/default_avatars/~catishe~cat~.jpg"},c=r(!1),S=r(!1),M=r(!1),_=r(!1),b=r(null),n=r(null),Z=r(null),q=r(null),K=r(null),v=r(!1),o=r({x:0,y:0,scale:1,width:0,height:0,naturalWidth:0,naturalHeight:0}),y=r(.1),$=r(3),w=r({x:0,y:0,imageX:0,imageY:0}),B=r(!1),Q=s=>{const e=s.target;o.value.naturalWidth=e.naturalWidth,o.value.naturalHeight=e.naturalHeight,o.value.x=0,o.value.y=0,o.value.width=e.naturalWidth,o.value.height=e.naturalHeight;const l=C/e.naturalWidth,d=C/e.naturalHeight;y.value=Math.max(l,d),$.value=y.value*5,o.value.scale=y.value},D=s=>{B.value=!0;const e=s.type.includes("mouse")?s.clientX:s.touches[0].clientX,l=s.type.includes("mouse")?s.clientY:s.touches[0].clientY;w.value={x:e,y:l,imageX:o.value.x,imageY:o.value.y}},T=s=>{if(!B.value)return;const e=s.type.includes("mouse")?s.clientX:s.touches[0].clientX,l=s.type.includes("mouse")?s.clientY:s.touches[0].clientY,d=e-w.value.x,a=l-w.value.y;o.value.x=w.value.imageX+d,o.value.y=w.value.imageY+a},H=()=>{B.value=!1},ee=s=>{const e=s.deltaY>0?-.1:.1,l=Math.max(y.value,Math.min($.value,o.value.scale+e));o.value.scale=l},k=r({show:!1,message:"",type:"success"}),p=(s,e="success")=>{k.value={show:!0,message:s,type:e},setTimeout(()=>k.value.show=!1,3e3)},te=["~atom~bomb~cat~.jpg","~catishe~cat~.jpg","~cranchy~view~cat~.jpg","~kayfishe~cat~.jpg","~lunishe~cat~.jpg","~mr~cat~.jpg","~void~cat~.jpg","~winter~cat~.jpg"],se=()=>{c.value=!1,S.value=!0,b.value=null,n.value=null},oe=()=>{c.value=!1,M.value=!0},R=()=>{S.value=!1,n.value&&URL.revokeObjectURL(n.value),b.value=null,n.value=null,v.value=!1},ae=s=>{const e=s.target.files[0];e&&Y(e),s.target.value=""},re=s=>{v.value=!1;const e=s.dataTransfer.files[0];e&&Y(e)},Y=s=>{if(!s.type.startsWith("image/")){p("Пожалуйста, загрузите изображение","error");return}n.value&&URL.revokeObjectURL(n.value),b.value=s,n.value=URL.createObjectURL(s)},le=()=>{if(!b.value)return;const s=new Image;s.src=n.value,s.onload=()=>{const e=document.createElement("canvas"),l=e.getContext("2d"),d=500;e.width=d,e.height=d;const a=o.value.scale,E=-o.value.x/a,ue=-o.value.y/a,j=C/a,de=o.value.naturalWidth/2+E-j/2,ce=o.value.naturalHeight/2+ue-j/2;l.drawImage(s,de,ce,j,j,0,0,d,d),e.toBlob(async ve=>{const I=await f.uploadAvatar(ve);I.success?(p("Аватар успешно обновлен"),R()):p({"Only JPG and PNG are allowed":"Разрешены только форматы JPG и PNG","File too large":"Файл слишком большой","Invalid file type":"Неверный тип файла"}[I.error]||I.error,"error")},"image/jpeg",.9)}},ne=async s=>{const e=`/jp-ru-dict/assets/default_avatars/${s}`,l=await f.updateAvatarUrl(e);l.success?(p("Аватар обновлен"),M.value=!1):p(l.error,"error")},ie=async()=>{const e=await f.updateAvatarUrl("/jp-ru-dict/assets/default_avatars/~catishe~cat~.jpg");e.success?(p("Аватар сброшен"),c.value=!1):p(e.error,"error")};return me(()=>{f.fetchUser(),A.fetchWords()}),xe(()=>{n.value&&URL.revokeObjectURL(n.value)}),(s,e)=>{var l,d;return u(),i("div",je,[t("div",Le,[e[19]||(e[19]=t("h1",{class:"text-3xl font-bold mb-8 text-primary"},"Личный кабинет",-1)),t("div",Ue,[t("div",ze,[t("div",Se,[t("div",$e,[t("img",{src:G.value,onError:J,alt:"Avatar",class:"w-full h-full object-cover"},null,40,Be)]),t("div",{class:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 cursor-pointer z-10",onClick:e[0]||(e[0]=x(a=>c.value=!c.value,["stop"]))},[...e[9]||(e[9]=[t("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1)])]),c.value?(u(),i("div",{key:0,class:"fixed inset-0 z-20",onClick:e[1]||(e[1]=a=>c.value=!1)})):m("",!0),c.value?(u(),i("div",He,[t("button",{onClick:se,class:"w-full text-left px-4 py-2 hover:bg-background/50 transition-colors flex items-center text-text-primary"},[...e[10]||(e[10]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1),U(" Загрузить фото ",-1)])]),t("button",{onClick:oe,class:"w-full text-left px-4 py-2 hover:bg-background/50 transition-colors flex items-center text-text-primary"},[...e[11]||(e[11]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1),U(" Выбрать готовую ",-1)])]),t("button",{onClick:ie,class:"w-full text-left px-4 py-2 hover:bg-red-500/10 text-red-500 transition-colors flex items-center"},[...e[12]||(e[12]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),U(" Удалить ",-1)])])])):m("",!0)]),t("div",Re,[t("div",Ie,[t("h2",Ae,h(((l=g.value)==null?void 0:l.name)||"Пользователь"),1),t("div",De,[e[13]||(e[13]=t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1)),t("span",null,h((d=g.value)==null?void 0:d.email),1)]),t("div",Te,[e[14]||(e[14]=t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),t("span",null,h(P.value),1)])]),e[17]||(e[17]=t("div",{class:"h-px bg-border/50 my-4"},null,-1)),t("div",Ye,[t("div",Ee,[t("div",We,[e[15]||(e[15]=t("svg",{class:"w-4 h-4 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})],-1)),e[16]||(e[16]=t("span",{class:"text-text-secondary text-sm font-medium"},"Изучено слов",-1)),t("span",Xe,h(V.value),1)])])])])]),t("div",{class:"absolute top-8 right-8"},[t("button",{onClick:N,class:"px-5 py-2.5 text-sm font-medium text-white bg-primary hover:bg-primary/90 rounded-xl transition-all duration-200 shadow-md hover:shadow-lg active:translate-y-0 flex items-center justify-center gap-2"},[...e[18]||(e[18]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),U(" Выйти ",-1)])])])])]),S.value?(u(),i("div",Oe,[t("div",Ve,[n.value?m("",!0):(u(),i("button",{key:0,onClick:R,class:"absolute top-4 right-4 text-text-secondary hover:text-text-primary transition-colors"},[...e[20]||(e[20]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])),e[25]||(e[25]=t("h3",{class:"text-xl font-bold mb-4 text-text-primary"},"Загрузка аватара",-1)),b.value?(u(),i("div",Pe,[t("div",{ref_key:"cropperContainer",ref:Z,class:"relative w-full h-80 bg-stone-900 rounded-xl overflow-hidden cursor-move touch-none select-none",onMousedown:D,onTouchstart:x(D,["prevent"]),onMousemove:T,onTouchmove:x(T,["prevent"]),onMouseup:H,onTouchend:H,onMouseleave:H,onWheel:x(ee,["prevent"])},[t("img",{ref_key:"cropperImage",ref:q,src:n.value,class:"absolute max-w-none origin-center pointer-events-none will-change-transform",style:W({transform:`translate(${o.value.x}px, ${o.value.y}px) scale(${o.value.scale})`,width:`${o.value.width}px`,height:`${o.value.height}px`,left:"50%",top:"50%",marginLeft:`-${o.value.width/2}px`,marginTop:`-${o.value.height/2}px`}),onLoad:Q},null,44,Ne),t("div",Fe,[e[22]||(e[22]=t("div",{class:"absolute inset-0 bg-black/60"},null,-1)),t("div",{class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 border-2 border-white/80 rounded-full shadow-[0_0_0_9999px_rgba(0,0,0,0.6)] box-content",style:W({width:`${C}px`,height:`${C}px`})},null,4)])],544),t("div",Ge,[e[23]||(e[23]=t("svg",{class:"w-5 h-5 text-text-secondary flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1)),ge(t("input",{type:"range","onUpdate:modelValue":e[6]||(e[6]=a=>o.value.scale=a),min:y.value,max:$.value,step:"0.01",class:"flex-1 h-1.5 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-primary hover:accent-primary/80"},null,8,Je),[[he,o.value.scale,void 0,{number:!0}]]),e[24]||(e[24]=t("svg",{class:"w-5 h-5 text-text-secondary flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1))])])):(u(),i("div",{key:1,class:z(["border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all duration-200",[v.value?"border-primary bg-primary/5 scale-[1.02]":"border-border hover:border-primary bg-background"]]),onDragover:e[2]||(e[2]=x(()=>{},["prevent"])),onDragenter:e[3]||(e[3]=x(a=>v.value=!0,["prevent"])),onDragleave:e[4]||(e[4]=x(a=>v.value=!1,["prevent"])),onDrop:x(re,["prevent"]),onClick:e[5]||(e[5]=a=>s.$refs.fileInput.click())},[t("input",{type:"file",ref_key:"fileInput",ref:K,class:"hidden",accept:"image/jpeg,image/png",onChange:ae},null,544),(u(),i("svg",{class:z(["w-12 h-12 mx-auto mb-2 transition-colors duration-200",v.value?"text-primary":"text-text-secondary"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[21]||(e[21]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"},null,-1)])],2)),t("p",{class:z(["transition-colors duration-200",v.value?"text-primary font-medium":"text-text-secondary"])},h(v.value?"Отпустите файл для загрузки":"Нажмите или перетащите изображение сюда"),3)],34)),n.value?(u(),i("div",Ze,[t("button",{onClick:R,class:"px-6 py-2 bg-transparent hover:bg-stone-100 text-text-secondary font-medium rounded-xl transition-all"},"Отмена"),t("button",{onClick:le,class:"px-6 py-2 bg-primary hover:bg-primary/90 text-white font-medium rounded-xl transition-all shadow-md hover:shadow-lg active:translate-y-0"},"Сохранить")])):m("",!0)])])):m("",!0),M.value?(u(),i("div",qe,[t("div",Ke,[e[26]||(e[26]=t("h3",{class:"text-xl font-bold mb-4 text-text-primary"},"Выберите аватара",-1)),t("div",Qe,[(u(),i(be,null,ye(te,a=>t("button",{key:a,onClick:E=>ne(a),class:"rounded-full overflow-hidden border-2 border-transparent hover:border-primary transition-all focus:outline-none focus:ring-2 focus:ring-primary aspect-square group relative"},[t("img",{src:`/jp-ru-dict/assets/default_avatars/${a}`,class:"w-full h-full object-cover transform transition-transform group-hover:scale-110"},null,8,tt)],8,et)),64))]),t("div",st,[t("button",{onClick:e[7]||(e[7]=a=>M.value=!1),class:"px-4 py-2 text-text-secondary hover:bg-background rounded-lg transition-colors"},"Отмена")])])])):m("",!0),_.value?(u(),i("div",ot,[t("div",at,[e[27]||(e[27]=t("h3",{class:"text-xl font-bold mb-4 text-text-primary"},"Вы точно хотите выйти?",-1)),t("div",rt,[t("button",{onClick:e[8]||(e[8]=a=>_.value=!1),class:"px-6 py-2 bg-transparent hover:bg-stone-100 text-text-secondary font-medium rounded-xl transition-all"},"Нет"),t("button",{onClick:F,class:"px-6 py-2 bg-primary hover:bg-primary/90 text-white font-medium rounded-xl transition-all shadow-md hover:shadow-lg active:translate-y-0"},"Да")])])])):m("",!0),fe(ke,{"enter-active-class":"transform ease-out duration-300 transition","enter-from-class":"translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2","enter-to-class":"translate-y-0 opacity-100 sm:translate-x-0","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:we(()=>[k.value.show?(u(),i("div",lt,[t("div",{class:z(["w-2 h-2 rounded-full",k.value.type==="error"?"bg-red-500":"bg-green-500"])},null,2),t("p",nt,h(k.value.message),1)])):m("",!0)]),_:1})])}}};export{vt as default};

